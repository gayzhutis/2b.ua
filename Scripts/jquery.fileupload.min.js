/*
* jQuery File Upload Plugin 4.5.1
* https://github.com/blueimp/jQuery-File-Upload
*
* Copyright 2010, Sebastian Tschan
* https://blueimp.net
*
* Licensed under the MIT license:
* http://creativecommons.org/licenses/MIT/
*/

/*jslint browser: true, unparam: true */
/*global XMLHttpRequestUpload, File, FileReader, FormData, ProgressEvent, unescape, jQuery, upload */

(function(a){"use strict";var d="file_upload",c="undefined",b="function",g,e,f=function(d,b){var c=0,a=[];if(b)if(b.length)a=b;else a[b-1]=null;this.complete=function(){c+=1;if(c===a.length){d(a);c=0;a=[]}};this.push=function(b){a.push(b)};this.getList=function(){return a}},h=function(){var a=[];this.push=function(b){a.push(b);a.length===1&&b()};this.next=function(){a.shift();a.length&&a[0]()}};g=function(g){var j=this,m,r,e={"namespace":d,uploadFormFilter:function(){return true},fileInputFilter:function(){return true},cssClass:d,dragDropSupport:true,dropZone:g,url:function(a){return a.attr("action")},method:function(a){return a.attr("method")},fieldName:function(a){return a.attr("name")},formData:function(a){return a.serializeArray()},requestHeaders:null,multipart:true,multiFileRequest:false,withCredentials:false,forceIframeUpload:false,sequentialUploads:false,maxChunkSize:null,maxFileReaderSize:5e7,replaceFileInput:true},k={},l={},Y=/^http(s)?:\/\//,v,q=new f(function(a){if(typeof e.onLoadAll===b)e.onLoadAll(a)}),w=new h,i=function(){q.complete();w.next()},E=function(){return typeof XMLHttpRequest!==c&&typeof XMLHttpRequestUpload!==c&&typeof File!==c&&(!e.multipart||typeof FormData!==c||typeof FileReader!==c&&typeof XMLHttpRequest.prototype.sendAsBinary===b)},F=function(){if(e.dragDropSupport){if(typeof e.onDocumentDragEnter===b)k["dragenter."+e.namespace]=function(a){e.onDocumentDragEnter(a)};if(typeof e.onDocumentDragLeave===b)k["dragleave."+e.namespace]=function(a){e.onDocumentDragLeave(a)};k["dragover."+e.namespace]=j.onDocumentDragOver;k["drop."+e.namespace]=j.onDocumentDrop;a(document).bind(k);if(typeof e.onDragEnter===b)l["dragenter."+e.namespace]=function(a){e.onDragEnter(a)};if(typeof e.onDragLeave===b)l["dragleave."+e.namespace]=function(a){e.onDragLeave(a)};l["dragover."+e.namespace]=j.onDragOver;l["drop."+e.namespace]=j.onDrop;e.dropZone.bind(l)}r.bind("change."+e.namespace,j.onChange)},C=function(){a.each(k,function(c,b){a(document).unbind(c,b)});a.each(l,function(b,a){e.dropZone.unbind(b,a)});r.unbind("change."+e.namespace)},p=function(a){return typeof a.uploadedBytes!==c},o=function(f,d,e){var a;if(typeof document.createEvent===b&&typeof ProgressEvent!==c){a=document.createEvent("ProgressEvent");a.initProgressEvent("progress",false,false,f,d,e)}else a={lengthComputable:true,loaded:d,total:e};return a},u=function(d,f,b){var e,a;if(typeof b.progressTotal===c)if(d[f]){a=d[f].size;b.progressTotal=a?a:1}else{a=0;for(e=0;e<d.length;e+=1)a+=d[e].size;b.progressTotal=a}return b.progressTotal},t=function(e,i,j,k,c){var f,d,g=0,h=0;if(e.lengthComputable&&typeof c.onProgressAll===b){c.progressLoaded=parseInt(e.loaded/e.total*u(i,j,c),10);d=q.getList();a.each(d,function(b,a){g+=a[3].progressLoaded||0;h+=u(a[0],a[1],a[3])});f=o(true,g,h);c.onProgressAll(f,d)}},V=function(f,c,d,e,a){var g;if(p(a)){a.uploadedBytes+=a.chunkSize;g=o(true,a.uploadedBytes,c[d].size);if(typeof a.onProgress===b)a.onProgress(g,c,d,e,a);t(g,c,d,e,a);if(a.uploadedBytes<c[d].size){if(typeof a.resumeUpload===b)a.resumeUpload(f,c,d,e,a,function(){s(f,c,d,e,a,true)});else s(f,c,d,e,a,true);return}}a.progressLoaded=u(c,d,a);if(typeof a.onLoad===b)a.onLoad(f,c,d,e,a);i()},R=function(c,e,f,g,a){var d=c;if(p(a)&&c.lengthComputable)d=o(true,a.uploadedBytes+parseInt(c.loaded/c.total*a.chunkSize,10),e[f].size);if(typeof a.onProgress===b)a.onProgress(d,e,f,g,a);t(d,e,f,g,a)},O=function(d,e,c,a){if(c.upload)c.upload.onprogress=function(b){R(b,d,e,c,a)};c.onload=function(b){V(b,d,e,c,a)};c.onabort=function(f){a.progressTotal=a.progressLoaded;if(typeof a.onAbort===b)a.onAbort(f,d,e,c,a);i()};c.onerror=function(f){a.progressTotal=a.progressLoaded;if(typeof a.onError===b)a.onError(f,d,e,c,a);i()}},L=function(a){return typeof a.url===b?a.url(a.uploadForm||m):a.url},K=function(a){return typeof a.method===b?a.method(a.uploadForm||m):a.method},y=function(a){return typeof a.fieldName===b?a.fieldName(a.fileInput||r):a.fieldName},z=function(c){var d;if(typeof c.formData===b)return c.formData(c.uploadForm||m);else if(a.isArray(c.formData))return c.formData;else if(c.formData){d=[];a.each(c.formData,function(b,a){d.push({name:b,value:a})});return d}return[]},Z=function(b){if(Y.test(b)){var f=location.host,c=location.protocol.length+2,d=b.indexOf(f,c),e=d+f.length;return(d===c||d===b.indexOf("@",c)+1)&&(b.length===e||a.inArray(b.charAt(e),["/","?","#"])!==-1)?true:false}return true},S=function(g,h,c,b){var d=g[h],e=L(b),f=Z(e);c.open(K(b),e,true);if(f){c.setRequestHeader("X-Requested-With","XMLHttpRequest");if(!b.multipart||p(b)){c.setRequestHeader("X-File-Name",d.name);c.setRequestHeader("X-File-Type",d.type);c.setRequestHeader("X-File-Size",d.size);if(!p(b))c.setRequestHeader("Content-Type",d.type);else!b.multipart&&c.setRequestHeader("Content-Type","application/octet-stream")}}else if(b.withCredentials)c.withCredentials=true;if(a.isArray(b.requestHeaders))a.each(b.requestHeaders,function(b,a){c.setRequestHeader(a.name,a.value)});else b.requestHeaders&&a.each(b.requestHeaders,function(b,a){c.setRequestHeader(b,a)})},X=function(e,f,d){var c=new FormData,b;a.each(z(d),function(b,a){c.append(a.name,a.value)});for(b=0;b<e.length;b+=1)c.append(y(d),e[b]);f.send(c)},W=function(a,b){a.reader=new FileReader;a.reader.onload=b;a.reader.readAsBinaryString(a)},n=function(a){return unescape(encodeURIComponent(a))},P=function(f,i,g,h){var d="--",b="\r\n",c="",e=[];a.each(h,function(e,a){c+=d+f+b+'Content-Disposition: form-data; name="'+n(a.name)+'"'+b+b+n(a.value)+b});a.each(i,function(h,a){c+=d+f+b+'Content-Disposition: form-data; name="'+n(g)+'"; filename="'+n(a.name)+'"'+b+"Content-Type: "+n(a.type)+b+b;e.push(c);e.push(a.reader.result);delete a.reader;c=b});c+=d+f+d+b;e.push(c);return e.join("")},T=function(a,g,d){var c="----MultiPartFormBoundary"+ +new Date,e,b;g.setRequestHeader("Content-Type","multipart/form-data; boundary="+c);e=new f(function(){g.sendAsBinary(P(c,a,y(d),z(d)))},a.length);for(b=0;b<a.length;b+=1)W(a[b],e.complete)},ab=function(a,d){var e,c=d.uploadedBytes,f=d.maxChunkSize;if(a&&typeof a.slice===b&&(c||f&&f<a.size)){d.uploadedBytes=c=c||0;e=a.slice(c,f||a.size-c);d.chunkSize=e.size;return e}return a},s=function(k,f,g,e,d,j){var h;h=function(){if(!j)if(typeof d.onSend===b&&d.onSend(k,f,g,e,d)===false){i();return}var l=ab(f[g],d),h;O(f,g,e,d);S(f,g,e,d);if(!d.multipart)if(e.upload)e.send(l);else a.error("Browser does not support XHR file uploads");else{h=typeof g==="number"?[l]:f;if(typeof FormData!==c)X(h,e,d);else if(typeof FileReader!==c&&typeof e.sendAsBinary===b)T(h,e,d);else a.error("Browser does not support multipart/form-data XHR file uploads")}};if(!j){q.push(Array.prototype.slice.call(arguments,1));if(d.sequentialUploads){w.push(h);return}}h()},I=function(d,f,i,j,g){var h=new XMLHttpRequest,c=a.extend({},e);c.fileInput=i;c.uploadForm=j;if(typeof c.initUpload===b)c.initUpload(d,f,g,h,c,function(){s(d,f,g,h,c)});else s(d,f,g,h,c)},B=function(i,d,e,h,g){var b=0,f;if(typeof e===c)a.each(d,function(c,a){b+=a.size?a.size:1});else b=d[e].size?d[e].size:1;f=o(true,b,b);g.progressLoaded=b;t(f,d,e,h,g)},N=function(e,c,b){var d=z(b);c.find(":input").not(":disabled").attr("disabled",true).addClass(b.namespace+"_disabled");a.each(d,function(e,d){a('<input type="hidden"/>').attr("name",d.name).val(d.value).addClass(b.namespace+"_form_data").appendTo(c)});e.attr("name",y(b)).appendTo(c)},M=function(c,b,a){c.detach();b.find("."+a.namespace+"_disabled").removeAttr("disabled").removeClass(a.namespace+"_disabled");b.find("."+a.namespace+"_form_data").remove()},J=function(k,f,j,e,d,c,g){var h;h=function(){if(typeof c.onSend===b&&c.onSend(k,f,g,d,c)===false){i();return}var h={action:e.attr("action"),method:e.attr("method"),target:e.attr("target"),enctype:e.attr("enctype")};d.unbind("abort").bind("abort",function(a){d.readyState=0;d.unbind("load").attr("src","javascript".concat(":false;"));B(a,f,g,d,c);if(typeof c.onAbort===b)c.onAbort(a,f,g,d,c);i()}).unbind("load").bind("load",function(h){d.readyState=4;B(h,f,g,d,c);if(typeof c.onLoad===b)c.onLoad(h,f,g,d,c);a('<iframe src="javascript:false;" style="display:none;"></iframe>').appendTo(e).remove();i()});e.attr("action",L(c)).attr("method",K(c)).attr("target",d.attr("name")).attr("enctype","multipart/form-data");N(j,e,c);d.readyState=2;e.get(0).submit();M(j,e,c);a.each(h,function(b,a){if(a)e.attr(b,a);else e.removeAttr(b)})};q.push([f,g,d,c]);if(c.sequentialUploads)w.push(h);else h()},H=function(b,a){if(typeof a.name===c&&typeof a.size===c){a.name=a.fileName;a.size=a.fileSize}},D=function(g,i,j,h){if(!(g&&i&&j)){a.error("Iframe based File Upload requires a file input change event");return}var c=a('<iframe src="javascript:false;" style="display:none;" name="iframe_'+e.namespace+"_"+ +new Date+'"></iframe>'),f=a.extend({},e),d=g.target&&g.target.files;d=d?Array.prototype.slice.call(d,0):[{name:i.val(),type:null,size:null}];a.each(d,H);h=d.length===1?0:h;f.fileInput=i;f.uploadForm=j;c.readyState=0;c.abort=function(){c.trigger("abort")};c.bind("load",function(){c.unbind("load");if(typeof f.initUpload===b)f.initUpload(g,d,h,c,f,function(){J(g,d,i,j,c,f,h)});else J(g,d,i,j,c,f,h)}).appendTo(j)},Q=function(f){var b=0,d=0,a;if(e.multipart&&typeof FormData===c){for(a=0;a<f.length;a+=1){b=f[a].size;if(b>e.maxFileReaderSize)return false;d+=b}if(e.multiFileRequest&&d>e.maxFileReaderSize)return false}return true},A=function(d,b,f,g){if(!Q(b)){D(d,f,g);return}var c;b=Array.prototype.slice.call(b,0);a.each(b,H);if(e.multiFileRequest&&e.multipart&&b.length)I(d,b,f,g);else for(c=0;c<b.length;c+=1)I(d,b,f,g,c)},G=function(){m=(g.is("form")?g:g.find("form")).filter(e.uploadFormFilter)},x=function(){r=(m.length?m:g).find("input:file").filter(e.fileInputFilter)},U=function(c){var b=c.clone(true);a("<form/>").append(b).get(0).reset();c.after(b).detach();x()};this.onDocumentDragOver=function(a){if(typeof e.onDocumentDragOver===b&&e.onDocumentDragOver(a)===false)return false;a.preventDefault()};this.onDocumentDrop=function(a){if(typeof e.onDocumentDrop===b&&e.onDocumentDrop(a)===false)return false;a.preventDefault()};this.onDragOver=function(c){if(typeof e.onDragOver===b&&e.onDragOver(c)===false)return false;var a=c.originalEvent.dataTransfer;if(a&&a.files){a.dropEffect=a.effectAllowed="copy";c.preventDefault()}};this.onDrop=function(a){if(typeof e.onDrop===b&&e.onDrop(a)===false)return false;var c=a.originalEvent.dataTransfer;c&&c.files&&E()&&A(a,c.files);a.preventDefault()};this.onChange=function(c){if(typeof e.onChange===b&&e.onChange(c)===false)return false;var f=a(c.target),g=a(c.target.form);if(g.length===1){if(e.replaceFileInput){f.data(d+"_form",g);U(f)}}else g=f.data(d+"_form");if(!e.forceIframeUpload&&c.target.files&&E())A(c,c.target.files,f,g);else D(c,f,g)};this.init=function(c){if(c){a.extend(e,c);v=c}G();x();if(g.data(e.namespace)){a.error('FileUpload with namespace "'+e.namespace+'" already assigned to this element');return}g.data(e.namespace,j).addClass(e.cssClass);e.dropZone.not(g).addClass(e.cssClass);F();typeof e.init===b&&e.init()};this.options=function(h){var d,b,i,f;if(typeof h===c)return a.extend({},e);v&&a.extend(v,h);C();a.each(h,function(c,g){switch(c){case"namespace":a.error("The FileUpload namespace cannot be updated.");return;case"uploadFormFilter":i=true;f=true;break;case"fileInputFilter":f=true;break;case"cssClass":d=e.cssClass;break;case"dropZone":b=e.dropZone}e[c]=g});i&&G();f&&x();if(typeof d!==c){g.removeClass(d).addClass(e.cssClass);(b?b:e.dropZone).not(g).removeClass(d);e.dropZone.not(g).addClass(e.cssClass)}else if(b){b.not(g).removeClass(e.cssClass);e.dropZone.not(g).addClass(e.cssClass)}F()};this.option=function(d,b){var a;if(typeof b===c)return e[d];a={};a[d]=b;j.options(a)};this.destroy=function(){typeof e.destroy===b&&e.destroy();C();g.removeData(e.namespace).removeClass(e.cssClass);e.dropZone.not(g).removeClass(e.cssClass)};this.upload=function(a){if(typeof a.length===c)a=[a];A(null,a)}};e={init:function(b){return this.each(function(){new g(a(this)).init(b)})},option:function(e,g,b){b=b?b:d;var f=a(this).data(b);if(f){if(!e)return f.options();else if(typeof e==="string"&&typeof g===c)return f.option(e)}else a.error('No FileUpload with namespace "'+b+'" assigned to this element');return this.each(function(){var c=a(this).data(b);if(c)if(typeof e==="string")c.option(e,g);else c.options(e);else a.error('No FileUpload with namespace "'+b+'" assigned to this element')})},destroy:function(b){b=b?b:d;return this.each(function(){var c=a(this).data(b);if(c)c.destroy();else a.error('No FileUpload with namespace "'+b+'" assigned to this element')})},upload:function(c,b){b=b?b:d;return this.each(function(){var d=a(this).data(b);if(d)d.upload(c);else a.error('No FileUpload with namespace "'+b+'" assigned to this element')})}};a.fn.fileUpload=function(b){if(e[b])return e[b].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof b==="object"||!b)return e.init.apply(this,arguments);else a.error('Method "'+b+'" does not exist on jQuery.fileUpload')}})(jQuery)